{% extends 'base.html' %}

{% block contents%}
    <hr>
    {{ post.title }}<br>
    {{ post.body }}<br>
    <hr>

    <div id="commentList">
        {% for comment in comments %}
            {{ comment.body }}<br>
        {% endfor %}
    </div>
    <div id="comments">
        <form action="{% url 'addcomment' post.id %}" id="commentForm" method="POST">
            {% csrf_token %}
            {{ form }}
            <button class="addComment">댓글쓰기</button>
        </form>
    </div>
{% endblock %}

{% block script %}
    <script type="text/javascript">

    $(document).ready(function() {
        $('.addComment').click(function() {
            // $('#commentForm').submit(function(event) {
            //     event.preventDefault();
                var postid = "{{ post.id }}";
                $.ajax ({
                    type: "POST",
                    url: "/blog/detail/addComment/"+postid,
                    cache: false,
                    data:  $('#commentBody').serialize(),
                    dataType: 'json',
                    success  : function(data){
                        $('#commentList').append(data+"<br>");
                        $('#commentBody').val("");
                        console.log("success ajax");
                        },
                    error: function (xhr, status) {
                        alert("Sorry, there was a problem!");
                        }
                });
                return false;
            // });
        });
        console.log("end ajax");
    });
        // function getComment() {
        //     var postid = "{{ post.id }}"
        // };
        // $(document).ready(function() {
        //     $('.addComment').click(function(event) {
        //         $('#commentForm').submit(function() {
        //             var postid = "{{ post.id }}"
        //             $.ajax({
        //                 type: "POST",
        //                 data: {
        //                    commentBody = $('#commentBody').value()
        //                 },
        //                 url: "/blog/detail/addComment/"+ postid,
        //                 // cache: false,
        //                 dataType: "json",
        //                 success: function (data) {
        //                     alert(data);
        //                     $('commentList').append(data);
        //                 },
        //                 error: function(XMLHttpRequest, textStatus, errorThrow) {
        //                     $('#commentForm form').replaceWith('Your comment was unable to be posted at this time.  We apologise for the inconvenience.');
        //                 }
        //             });
        //             return false;
        //         });
        //     });
        // });
    </script>
{% endblock %}